#INCLUDE "RWMAKE.CH" 
#INCLUDE "MSOLE.CH"
#INCLUDE "PROTHEUS.CH"

#define STR0001 "Pesquisar"
#define STR0002 "Captura Foto"
#define STR0003 "ImpressЦo de CrachАs"
#define STR0004 "Obtem foto"
#define STR0005 "Foto"

/*/
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠зддддддддддбддддддддддбдддддддбдддддддддддддддддддддддбддддддбдддддддддд©╠╠
╠╠ЁFun┤┘o    Ё CAPFOTO  Ё Autor Ё Equipe RH             Ё Data Ё 05/08/04 Ё╠╠
╠╠цддддддддддеддддддддддадддддддадддддддддддддддддддддддаддддддадддддддддд╢╠╠
╠╠ЁDescri┤┘o Ё Captura de fotos.                                          Ё╠╠
╠╠цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠ЁSintaxe   Ё CAPFOTO()                                                  Ё╠╠
╠╠цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠Ё Uso      Ё Generico                                                   Ё╠╠
╠╠цддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠Ё         ATUALIZACOES SOFRIDAS DESDE A CONSTRU─AO INICIAL.             Ё╠╠
╠╠цддддддддддддбддддддддбддддддбдддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠ЁProgramador Ё Data   Ё BOPS Ё  Motivo da Alteracao                     Ё╠╠
╠╠цддддддддддддеддддддддеддддддедддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠Ё Equipe RH  Ё22/08/06Ё------Ё Transformado em RDMAKE.                  Ё╠╠
╠╠юддддддддддддаддддддддаддддддадддддддддддддддддддддддддддддддддддддддддды╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ/*/
User Function CAPFOTO()
//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//Ё Define Variaveis                                             Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
LOCAL cFiltraSRA			//Variavel para filtro
LOCAL aIndexSRA	:= {}		//Variavel Para Filtro

Private bFiltraBrw := {|| Nil}		//Variavel para Filtro
Private	cPerg	:= "PNA900"
Private aInfo	:= {}
Private nDepen	:= 0
Private aRegs	:= {}


//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//Ё Define array contendo as Rotinas a executar do programa      Ё
//Ё ----------- Elementos contidos por dimensao ------------     Ё
//Ё 1. Nome a aparecer no cabecalho                              Ё
//Ё 2. Nome da Rotina associada                                  Ё
//Ё 3. Usado pela rotina                                         Ё
//Ё 4. Tipo de Transa┤└o a ser efetuada                          Ё
//Ё    1 - Pesquisa e Posiciona em um Banco de Dados             Ё
//Ё    2 - Simplesmente Mostra os Campos                         Ё
//Ё    3 - Inclui registros no Bancos de Dados                   Ё
//Ё    4 - Altera o registro corrente                            Ё
//Ё    5 - Remove o registro corrente do Banco de Dados          Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
Private aRotina := { 	{ STR0001 , "PesqBrw"  , 0 , 1},;  //"Pesquisar" 
						{ STR0002 , "u_pn900Capt", 0 , 4}} //"Captura da Foto"
//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//Ё Define o cabecalho da tela de atualizacoes                   Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
Private cCadastro := OemToAnsi(STR0003)  //"Impressao de Crachas"
//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//Ё Verifica se o Arquivo Esta Vazio                             Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
If !ChkVazio("SRA")
	Return
Endif
	
//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//Ё Inicializa o filtro utilizando a funcao FilBrowse                      Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
cFiltraRh := CHKRH("CAPFOTO","SRA","1")
cFiltraRh := cFiltraRh + if(empty(cFiltraRh),'RA_SITFOLH <> "D"','.AND. RA_SITFOLH <> "D"')
bFiltraBrw 	:= {|| FilBrowse("SRA",@aIndexSRA,@cFiltraRH) }
Eval(bFiltraBrw)
	
//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//Ё Endereca a funcao de BROWSE                                  Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
dbSelectArea("SRA")
dbGoTop()
mBrowse( 6, 1,22,75,"SRA" , NIL , NIL , NIL , NIL , NIL , fCriaCor() )
	
//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//Ё Deleta o filtro utilizando a funcao FilBrowse                     	   Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
EndFilBrw("SRA",aIndexSra)

return

/*/
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠зддддддддддбддддддддддбдддддддбдддддддддддддддддддддддбддддддбдддддддддд©╠╠
╠╠ЁFun┤┘o    Ё pn900CaptЁ Autor Ё Equipe RH             Ё Data Ё 09/08/04 Ё╠╠
╠╠цддддддддддеддддддддддадддддддадддддддддддддддддддддддаддддддадддддддддд╢╠╠
╠╠ЁDescri┤┘o Ё Programa captura e inclusao de fotos no repositorio de     Ё╠╠
╠╠Ё          Ё imagens e no cadastro de funcionarios.                     Ё╠╠
╠╠цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠ЁSintaxe   Ё pn900Capt(cAlias,nReg,nOpc)                                Ё╠╠
╠╠цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠ЁParametrosЁ cAlias  Alias do arquivo                                   Ё╠╠
╠╠Ё          Ё nReg    Numero do registro                                 Ё╠╠
╠╠Ё          Ё nOpc    Numero da opcao selecionada                        Ё╠╠
╠╠цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠Ё Uso      Ё pn900Capt                                                  Ё╠╠
╠╠юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ*/
User Function pn900Capt(cAlias,nReg,nOpc) //Transferida para GPER1018

Local aArea			:= GetArea()
Local aSvKeys		:= GetKeys()
Local aEnchoice		:= {}
Local aFields		:= {}
Local aAltera		:= {}
Local aNaoAltera	:= {}
Local aVirtChoice	:= {}
Local aVisual		:= {}
Local aAdvSize		:= {}
Local aInfoAdvSize	:= {}
Local aObjSize		:= {}
Local aObjCoords	:= {}
Local aBotoes		:= {}
Local bSet15		:= { || NIL }
Local bSet24		:= { || NIL }
Local nOpcAlt		:= 0.00
Local nX			:= 0.00
Local nXs			:= 0.00
Local oDlg			:= NIL
Local oEnchoice		:= NIL	
Local lGravouFoto	:= .F.     //Variavel Se Gravou a Foto

Private aFotos		:= {}		//Variavel para Fotos Capturadas
Private bGetFoto	:= { || NIL }

Private aGets[0]
Private aTela[0][0]

Begin Sequence
	
	
	//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	//Ё Monta os Dados para a Enchoice							   Ё
	//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
	
	aEnChoice := SRA->( GdMontaHeader( NIL , @aVirtChoice , @aVisual , NIL , { "RA_FILIAL","RA_MAT","RA_CC","RA_DESCCC","RA_NOME","RA_ADMISSA","RA_BITMAP","RA_APELIDO"},,,,.T.,,,,.F. ) ) 
	
	
	//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	//Ё Cria as Variaveis de Memoria e Carrega os Dados Conforme o arЁ
	//Ё quivo														   Ё
	//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
	nXs := Len( aEnChoice )
	For nX := 1 To nXs
		aAdd( aFields , aEnchoice[ nX , 02 ] )
		IF ( aScan( aVirtChoice , { |cVirt| cVirt ==  aEnchoice[ nX , 02 ] } ) == 0.00 )
			&( "M->"+aEnchoice[ nX , 02 ] ) := SRA->( &( aEnchoice[ nX , 02 ] ) )
		Else
			&( "M->"+aEnchoice[ nX , 02 ] ) := CriaVar( aEnchoice[ nX , 02 ] )
		EndIF
		
		//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
		//ЁNeste Ponto Carrega os Inicializadores padroes para campos  viЁ
		//Ёsuais														   Ё
		//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды*
		IF ( aScan( aVisual , { |cVisu| cVisu ==  aEnchoice[ nX , 02 ] } ) > 0.00 )
			IF Empty( &( "M->"+aEnchoice[ nX , 02 ] ) )
				&( "M->"+aEnchoice[ nX , 02 ] ) := CriaVar( aEnchoice[ nX , 02 ] )
			EndIF
		EndIF
	Next nX

	Aadd(aFields ,"NOUSER" )
	
	
	//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	//ЁDefine os Campos Editaveis na Enchoice Apenas na Alteracao(4) Ё
	//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды*
	IF nOpc == 4

		
		//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
		//Ё Define os Campos Editaveis								   Ё
		//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
		nXs := Len( aVisual )
		For nX := 1 To nXs
			aAdd( aNaoAltera , aVisual[ nX ] )
		Next nX
		aAdd( aNaoAltera , "RA_MAT" )
		aAdd( aNaoAltera , "RA_CC" )
		aAdd( aNaoAltera , "RA_NOME" )
		aAdd( aNaoAltera , "RA_ADMISSA" )
		aAdd( aNaoAltera , "RA_RG" )
		aAdd( aNaoAltera , "RA_CIC" )
		aAdd( aNaoAltera , "RA_APELIDO" )
		nXs := Len( aFields )
		For nX := 1 To nXs
			IF ( aScan( aNaoAltera , { |cNaoA| cNaoA == aFields[ nX ] } ) == 0.00 )
				aAdd( aAltera , aFields[ nX ] )
			EndIF
		Next nX
	
	EndIF
	
	
	//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	//Ё Monta as Dimensoes dos Objetos         					   Ё
	//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
	aAdvSize		:= MsAdvSize()
	aInfoAdvSize	:= { aAdvSize[1] , aAdvSize[2] , aAdvSize[3] , aAdvSize[4] , 0 , 0 }
	aAdd( aObjCoords , { 000 , 300 , .T. , .T. } ) 
	aObjSize		:= MsObjSize( aInfoAdvSize , aObjCoords )
	
	
	//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	//Ё Monta o Dialogo Principal para a Manutencao das Formulas	   Ё
	//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды*
	nOpcAlt := 0.00
	SetaPilha()
		DEFINE MSDIALOG oDlg TITLE OemToAnsi( cCadastro ) From aAdvSize[7],0 TO aAdvSize[6],aAdvSize[5] OF oMainWnd PIXEL
			oEnchoice	:= MsmGet():New( "SRA" , nReg , nOpc , NIL , NIL , NIL , aFields  , aObjSize[1] , aAltera  , NIL , NIL , NIL , oDlg , NIL , .F. )
			bSet15		:= { || IF( Obrigatorio( aGets , aTela ) , ( nOpcAlt := 1.00 , oDlg:End() ) , ( nOpcAlt := 0.00 , .F. ) ) }
			bSet24		:= { || ( nOpcAlt := 0.00 , oDlg:End() ) }
			bGetFoto	:= { || lGravouFoto:= u_Pn900GetFoto((xFilial("SRA")+M->RA_MAT), @aFotos, @oEnchoice)}
			aAdd(; 
					aBotoes	,;
					{;
						"MAQFOTO"			 ,;	
						bGetFoto			 ,;
						OemToAnsi( STR0004 ) ,;	//"Obtem Foto <F4>..."
						OemToAnsi( STR0005 ) ;	//"Foto"
					};
				)	    

		 SetKEY(VK_F4,bGetFoto)

		ACTIVATE MSDIALOG oDlg ON INIT EnchoiceBar( oDlg , bSet15 , bSet24 ,, aBotoes ) CENTERED
	SetaPilha()
	
	
	//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	//ЁQuando Confirmada a Opcao e Nao for Visualizacao Grava ou   ExЁ
	//Ёclui as Informacoes do SRA         				   		   Ё
	//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
	IF ( ( nOpcAlt == 1 ) .and. ( nOpc != 2 ) )
		
		//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
		//Ё Gravando a foto no campo RA_BITMAP do funcionario.           Ё
		//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
		Pn900Grava(nOpc,nReg,lGravouFoto)
	EndIF

End Sequence
	

//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//ЁRestaura os Dados de Entrada								   Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
( RestKeys( aSvKeys ) , RestArea( aArea ) )

Return( nOpcAlt )


/*/
ээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠зддддддддддбдддддддддддддддбдддддддбдддддддддддддддддддддддбддддддбдддддддддд©╠╠
╠╠ЁFuncao    ЁPn900GetFoto	 Ё Autor Ё Equipe RH             Ё Data Ё06.04.2004Ё╠╠
╠╠цддддддддддедддддддддддддддадддддддадддддддддддддддддддддддаддддддадддддддддд╢╠╠
╠╠ЁDescri┤┘o Ё Funcao p/ Captura de Foto								       Ё╠╠
╠╠цддддддддддеддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠ЁRetorno   Ё 			                                                       Ё╠╠
╠╠цддддддддддеддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠ЁParametrosЁ						   		  								   Ё╠╠
╠╠цдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠Ё         ATUALIZACOES SOFRIDAS DESDE A CONSTRU─AO INICIAL.             	   Ё╠╠
╠╠цддддддддддддбддддддддбддддддбддддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠ЁProgramador Ё Data   Ё BOPS Ё  Motivo da Alteracao                     	   Ё╠╠
╠╠цддддддддддддеддддддддеддддддеддддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠Ё            Ё        Ё      Ё                                               Ё╠╠
╠╠юддддддддддддаддддддддаддддддаддддддддддддддддддддддддддддддддддддддддддддддды╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ/*/
User function Pn900GetFoto(cIdFile, aFotos, oEnchoice)
                                    
Local lRet		:= .T.

Local cFileJpg	:= '' 
Local cPathSrv	:= ''
Local cPathFile	:= ''
Local cDestFile := ''

Local nHDImgDll	:= 0  
Local nRet		:= 0                                 

cPathSrv	:= Upper(GetTempPath())
cFileJpg	:=	Alltrim(cIdFile)+'.jpg'
cPathFile	:= UPPER(cPathSrv+cFileJpg)

Begin Sequence
  
  	RPCSETTYPE(3)
	
	nHDImgDll := ExecInDLLOpen("IMAGELOAD.DLL")
	If nHDImgDLL == -1
	   Alert("Falha ao carregar a DLL 'IMAGELOAD.DLL'.") 
       lRet	:=.F.
	   Break
	EndIf           
	                                             
	// Passar como parБmetro, o diretСrio na mАquina CLIENTE + NOME зNICO
	nRet:=ExeDLLRun2( nHDImgDll, 0, cPathFile) 
	If nRet == -1
	   Alert("Falha ao carregar o arquivo "+cPathFile) 
       lRet	:=.F.
	   Break
	EndIf 
	
	ExecInDLLClose( nHDImgDll)
	
    u_Pn900IncFoto(cIdFile)
    M->RA_BITMAP:=cIdFile  
    oEnchoice:aEntryCtrls[ 1 ]:Refresh()
    oEnchoice:Refresh()
    
    //-- Armazena Fotos para Posterior Eliminacao
    aadd(aFotos,{cPathFile, cDestFile } )
    
    //-- Verifica se Gravou em um dos Locais
    lRet:= ( File(cPathFile) .OR. File(cDestFile) )
End  

Return lRet


/*
ээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠зддддддддддбдддддддддддддбдддддддбдддддддддддддддддддддддбддддддбдддддддддд©╠╠
╠╠ЁFun┤┘o    ЁPn900IncFoto Ё Autor Ё Equipe RH             Ё Data Ё 06/04/04 Ё╠╠
╠╠цддддддддддедддддддддддддадддддддадддддддддддддддддддддддаддддддадддддддддд╢╠╠
╠╠ЁDescri┤┘o Ё Coloca a Foto no Repositorio        						  	 Ё╠╠
╠╠цддддддддддеддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠ЁSintaxe   ЁPn900IncFoto(cIdFile)										     Ё╠╠
╠╠цддддддддддеддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠ЁParametrosЁ cIdFile - Identificador da Foto (xFilial("SRA")+M->RA_MAT)    Ё╠╠
╠╠цддддддддддеддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠ЁRetorno   Ё lFile - Logico de Retorno de Sucesso da Inclusao da Foto      Ё╠╠
╠╠цддддддддддеддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠Ё Uso      Ё Pona900                                                       Ё╠╠
╠╠цдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠Ё         ATUALIZACOES SOFRIDAS DESDE A CONSTRU─AO INICIAL.             	 Ё╠╠
╠╠цддддддддддддбддддддддбддддддбддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠ЁProgramador Ё Data   Ё BOPS Ё  Motivo da Alteracao                     	 Ё╠╠
╠╠цддддддддддддеддддддддеддддддеддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠Ё            Ё        Ё      Ё                                             Ё╠╠
╠╠юддддддддддддаддддддддаддддддаддддддддддддддддддддддддддддддддддддддддддддды╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ*/
User Function Pn900IncFoto(cIdFile)

Local cDirAtu	:= ""

Local lFile		:= .T.
Local oDlg8
Local oBmp


//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//Ё Inclui a Foto              								   Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды

DEFINE MSDIALOG oDlg8   FROM -1000,400 TO 1600,800  PIXEL 

@ 000, 000 REPOSITORY oBmp SIZE 60, 73 OF oDlg8    

lFile	:= fPutFoto(@oBmp, cIdFile )

ACTIVATE MSDIALOG oDlg8 ON INIT (oBmp:lStretch := .T.,oDlg8:End())

Return lFile


/*
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠зддддддддддбддддддддддбдддддддбдддддддддддддддддддддддбддддддбдддддддддд©╠╠
╠╠ЁFun┤┘o    ЁfPutFoto  Ё Autor Ё Equipe RH             Ё Data Ё 06/08/04 Ё╠╠
╠╠цддддддддддеддддддддддадддддддадддддддддддддддддддддддаддддддадддддддддд╢╠╠
╠╠ЁDescri┤┘o Ё Insere  a Foto no Repositorio          					  Ё╠╠
╠╠цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠ЁSintaxe   ЁfPutFoto(oBmp,cIdFile)									  Ё╠╠
╠╠цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠ЁParametrosЁ cIdFile 	- Caminho do \RootPath							  Ё╠╠
╠╠цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠ЁRetorno   Ё lFile - Logico representado que Incluiu a Foto             Ё╠╠
╠╠цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠Ё Uso      Ё Pona900                                                    Ё╠╠
╠╠юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ*/
Static Function fPutFoto(oBmp,cIdFile)
Local lFile 	:= .T. 
Local cFileJpg	:= '' 
Local lIncluiu	:= .F.

cFileJpg		:=	Alltrim(cIdFile)+'.jpg'
cPathPict   	:= Upper(GetTempPath()+cFileJpg) 

		
IF !Empty( cPathPict)
	IF ( lFile	:= File( cPathPict) )                
		
		lFile	:= !Empty(oBmp:InsertBmp(cPathPict,,@lIncluiu))

		IF lFile .AND. lIncluiu
			oBmp:LoadBmp(cPathPict)
			oBmp:Refresh()
		Else
			Alert("Falha ao Incluir a Imagem no Repositorio") 
		Endif
		
	EndIF
EndIF

Return (lFile)

/*
зддддддддддбдддддддддддддбдддддбддддддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁPn900Grava   ЁAutorЁ Equipe RH            Ё Data Ё09/08/2004Ё
цддддддддддедддддддддддддадддддаддддддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o Ё                                                            Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁPona900()	                                                Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды*/
Static Function Pn900Grava(		nOpc		,;	//Opcao de Acordo com aRotina
							 	nReg		,;	//Numero do Registro do Arquivo Pai ( SRA )
							 	lGravouFoto  ;  //Se Capturou a Foto
							  )


Local lLock			:= .F.

DEFAULT nOpc		:= 0.00
DEFAULT nReg		:= 0.00

/*
здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
Ё Se for Inclusao/Alteracao ( nOpc == 3 .or. nOpc == 4 )	   Ё
юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды*/
IF nOpc == 4
	Begin Transaction
		IF !Empty( nReg )
			SRA->( MsGoto( nReg ) )
			lLock := RecLock( "SRA" , .F. , .F. )
		EndIF 
        
		IF !( lLock )
			Break
		EndIF

		//-- Inclui a Foto no Repositorio 	
        If lGravouFoto
			//-- Atualiza identifcador do BMP
			M->RA_BITMAP	:= xFilial("SRA")+M->RA_MAT
			SRA->RA_BITMAP	:= xFilial("SRA")+M->RA_MAT
		Endif
		
		SRA->( MsUnLock() )
	End Transaction
EndIF

Return( NIL )
